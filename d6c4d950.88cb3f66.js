(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{83:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return s})),n.d(t,"metadata",(function(){return i})),n.d(t,"toc",(function(){return l})),n.d(t,"default",(function(){return p}));var a=n(3),o=n(7),r=(n(0),n(89)),s={id:"activeworkflow-agent-python",title:"ActiveWorkflow Agent Python",sidebar_label:"ActiveWorkflow Agent Python"},i={unversionedId:"activeworkflow-agent-python",id:"activeworkflow-agent-python",isDocsHomePage:!1,title:"ActiveWorkflow Agent Python",description:"Helps you to develop your own ActiveWorkflow agents in Python.",source:"@site/docs/activeworkflow-agent-python.md",slug:"/activeworkflow-agent-python",permalink:"/activeworkflow-agent-python",version:"current",sidebar_label:"ActiveWorkflow Agent Python",sidebar:"docs",previous:{title:"Roadmap",permalink:"/roadmap"},next:{title:"ActiveWorkflow Agent Ruby",permalink:"/activeworkflow-agent-ruby"}},l=[{value:"Installation",id:"installation",children:[]},{value:"The Agent API Protocol",id:"the-agent-api-protocol",children:[]},{value:"Library Functionality",id:"library-functionality",children:[{value:"ParsedRequest",id:"parsedrequest",children:[]},{value:"RegisterResponse",id:"registerresponse",children:[]},{value:"CheckResponse",id:"checkresponse",children:[]},{value:"ReceiveResponse",id:"receiveresponse",children:[]}]},{value:"Example Agent",id:"example-agent",children:[]},{value:"Running an Agent Locally for Development",id:"running-an-agent-locally-for-development",children:[]},{value:"Source Code",id:"source-code",children:[]}],c={toc:l};function p(e){var t=e.components,n=Object(o.a)(e,["components"]);return Object(r.b)("wrapper",Object(a.a)({},c,n,{components:t,mdxType:"MDXLayout"}),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},"Helps you to develop your own ActiveWorkflow agents in Python.")),Object(r.b)("p",null,"The ",Object(r.b)("inlineCode",{parentName:"p"},"activeworkflow_agent")," library helps you to write your own ActiveWorkflow\nagents in Python using ActiveWorkflow's ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"remote-agent-api"}),"remote agent API"),".\n","\u201c","Remote","\u201d"," in this context means that agents run in separate processes\nfrom ActiveWorkflow itself. Communication between agents and ActiveWorkflow\ntakes place via HTTP. Each agent is effectively an HTTP server which ActiveWorkflow\nconnects to and interacts with via the ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"remote-agent-api#protocol"}),"remote agent API protocol"),"."),Object(r.b)("h2",{id:"installation"},"Installation"),Object(r.b)("p",null,"The library is available on PyPI:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-sh"}),"python -m pip install activeworkflow_agent\n")),Object(r.b)("p",null,"Python >= 3.7 is supported."),Object(r.b)("h2",{id:"the-agent-api-protocol"},"The Agent API Protocol"),Object(r.b)("p",null,"ActiveWorkflow talks to an agent over HTTP and all the requests and responses\nare in JSON. All communication happens using a single endpoint (the agent's\nregistered URL) and an agent has to implement and handle the following\n3 ","\u201c","methods","\u201d",":"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("strong",{parentName:"li"},"register"),": called to retrieve an agent's metadata (name, description, options)."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("strong",{parentName:"li"},"receive"),": called when an agent has to process a message."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("strong",{parentName:"li"},"check"),": called on schedule (as set by ActiveWorkflow users) and has no message to process.")),Object(r.b)("p",null,"For more details please see the ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"remote-agent-api#protocol"}),"remote agent API protocol"),"."),Object(r.b)("h2",{id:"library-functionality"},"Library Functionality"),Object(r.b)("p",null,"To deal with the protocol in your agent implementation this library offers four\nhelper classes that are described below."),Object(r.b)("h3",{id:"parsedrequest"},"ParsedRequest"),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},Object(r.b)("inlineCode",{parentName:"strong"},"ParsedRequest"))," is a helper class to parse the content of a ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"remote-agent-api#protocol"}),"request"),"\nfrom the ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"remote-agent-api"}),"ActiveWorkflow Agent API"),". A ParsedRequest object\nalways has the following attributes:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"method: a string containing the method called on the agent."),Object(r.b)("li",{parentName:"ul"},"options: a dictionary with all the agent options."),Object(r.b)("li",{parentName:"ul"},"memory: a dictionary with the state of the agent."),Object(r.b)("li",{parentName:"ul"},"credentials: a list of dictionaries containing credentials that the agent might need."),Object(r.b)("li",{parentName:"ul"},"message: a dictionary containing the message the agent received.")),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-python"}),'>>> import activeworkflow_agent as aw\n>>> request = aw.ParsedRequest(request.json)\n>>> request.method       # => "receive"\n>>> request.options      # => {"some": "option"}\n>>> request.memory       # => {"could": {"be": "anything"}}\n>>> request.credentials  # => [{"name": "admin_email", "value": "admin@example.com"}]\n>>> request.message      # => {"a": 1, "b": 2}\n\n')),Object(r.b)("h3",{id:"registerresponse"},"RegisterResponse"),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},Object(r.b)("inlineCode",{parentName:"strong"},"RegisterResponse"))," is a helper class to construct a response to the\n",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"remote-agent-api#the-register-method"}),"'register' method")," API call. It has the\nfollowing methods:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"to_dict()"),": returns the response as a dict."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"to_json()"),": returns the response as a JSON string.")),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-python"}),'>>> import activeworkflow_agent as aw\n>>> response = aw.RegisterResponse(\n...     name="ExampleAgent",\n...     display_name="Example Agent",\n...     description="Just an example agent.",\n...     default_options={"a": "b"}\n... )\n>>> response.to_json()\n\'{"result": {"name": "ExampleAgent", "display_name": "Example Agent", "description": "Just an example agent.", "default_options": {"a": "b"}}}\'\n')),Object(r.b)("h3",{id:"checkresponse"},"CheckResponse"),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},Object(r.b)("inlineCode",{parentName:"strong"},"CheckResponse"))," is helper class to construct a response to\nthe ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"remote-agent-api#the-check-method"}),"'check' method")," API call."),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"add_logs(*str)"),": add one or more log messages to the response object."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"add_errors(*str)"),": add one or more error messages to the response object."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"add_messages(*dict)"),": add the list of messages that the agent emits."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"add_memory(dict)"),": add the agent's memory (state) to the response object."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"to_dict()"),": returns the response as a dict."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"to_json()"),": returns the response as a JSON string.")),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-python"}),'>>> import activeworkflow_agent as aw\n>>> response = aw.CheckResponse()\n>>> response.add_logs("Check done")\n>>> response.add_errors("An error occurred")\n>>> response.to_json()\n\'{"result": {"errors": ["An error occurred"], "logs": ["Check done"], "memory": {}, "messages": []}}\'\n')),Object(r.b)("h3",{id:"receiveresponse"},"ReceiveResponse"),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},Object(r.b)("inlineCode",{parentName:"strong"},"ReceiveResponse"))," is a helper class to construct a response to the\n",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"remote-agent-api#the-receive-method"}),"'receive' method")," API call."),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"add_logs(*str)"),": add one or more log messages to the response object."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"add_errors(*str)"),": add one or more error messages to the response object."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"add_messages(*dict)"),": add the list of messages that the agent emits."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"add_memory(dict)"),": add the agent's memory (state) to the response object."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"to_dict()"),": returns the response as a dict."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"to_json()"),": returns the response as a JSON string.")),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-python"}),'>>> import activeworkflow_agent as aw\n>>> response.add_logs("New message received", "Message processed")\n>>> response.to_json()\n\'{"result": {"errors": [], "logs": ["New message received", "Message processed"], "memory": {}, "messages": []}}\'\n')),Object(r.b)("h2",{id:"example-agent"},"Example Agent"),Object(r.b)("p",null,"Below you can find an example of an ActiveWorkflow agent using the library\nhelper classes."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-python"}),'import json\n\nfrom flask import Flask\nfrom flask import jsonify\nfrom flask import request\n\nimport activeworkflow_agent as aw\n\n\napp = Flask(__name__)\n\n\n@app.route("/", methods=["POST"])\ndef handle():\n    # Use the ParsedRequest class to end up with a request object\n    # that contains all the values you care about.\n    parsed_request = aw.ParsedRequest(request.json)\n    agent = ExampleAgent(parsed_request)\n    response = agent.get_response()\n    return jsonify(response)\n\n\nclass ExampleAgent:\n    """This is the agent itself."""\n\n    def __init__(self, request):\n        """Created from scratch on each method invocation."""\n        # We are working with a ParsedRequest object here.\n        # A request from ActiveWorkflow\'s Agent API can have the following\n        # attributes: \'method\', \'options\', \'memory\', \'credentials\', \'message\'.\n        # A ParsedRequest object offers a convenient grouping of all these\n        # into one place.\n        self._method = request.method\n        self._options = request.options\n        self._memory = request.memory\n        self._credentials = request.credentials\n        self._message = request.message\n\n    def _respond_to_register(self):\n        """Register our metadata."""\n        # This gets called when ActiveWorkflow starts, in order to register\n        # the agent. We are working with the RegisterResponse class here.\n        response = aw.RegisterResponse(\n            name="ExampleAgent",\n            display_name="Example Agent",\n            description="Just an example agent.",\n            default_options={"a": "b"},\n        )\n\n        return response.to_dict()\n\n    def _respond_to_check(self):\n        """This is run on schedule. Do something useful."""\n        # Your agent receives a request with the \'check\' method when you have\n        # scheduled it to be called periodically. Here we use the CheckResponse class.\n        response = aw.CheckResponse()\n        response.add_logs("Check done")\n        response.add_errors("Fake error")\n        if self._memory.get("last_message"):\n            response.add_messages(self._memory["last_message"])\n\n        return response.to_dict()\n\n    def _respond_to_receive(self):\n        """Process the message received and do something with it."""\n        # Your agent receives a request with the \'receive\' method when another agent\n        # has sent it a message. Here we use the ReceiveResponse class to create\n        # a response to this.\n        response = aw.ReceiveResponse()\n        memory = {"last_message": self._message}\n        response.add_logs("New message received")\n        response.add_memory(memory)\n\n        return response.to_dict()\n\n    def get_response(self):\n        if self._method == "register":\n            response = self._respond_to_register()\n        elif self._method == "check":\n            response = self._respond_to_check()\n        elif self._method == "receive":\n            response = self._respond_to_receive()\n        else:\n            response = {}\n\n        return response\n\n\nif __name__ == "__main__":\n    app.run()\n')),Object(r.b)("h2",{id:"running-an-agent-locally-for-development"},"Running an Agent Locally for Development"),Object(r.b)("p",null,"Suppose that for development purposes you have created a simple agent that can\nrun locally on ",Object(r.b)("inlineCode",{parentName:"p"},"http://0.0.0.0:5000")," and you also run ActiveWorkflow using Docker.\nYou would typically proceed in the following manner:"),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},"You would first start your agent process at ",Object(r.b)("inlineCode",{parentName:"li"},"http://0.0.0.0:5000"),"."),Object(r.b)("li",{parentName:"ol"},"You would then start ActiveWorkflow locally with Docker, registering your\nagent by passing an environment variable. For example:\n",Object(r.b)("inlineCode",{parentName:"li"},'docker run -e REMOTE_AGENT_URL="http://host.docker.internal:5000/" -p 3000:3000 --rm automaticmode/active_workflow'),"."),Object(r.b)("li",{parentName:"ol"},"When starting, ActiveWorkflow would make a request to your agent at\n",Object(r.b)("inlineCode",{parentName:"li"},"http://0.0.0.0:5000")," with the 'register' method, in order to retrieve\nyour agent's information. (see ",Object(r.b)("a",Object(a.a)({parentName:"li"},{href:"remote-agent-api/#the-register-method"}),"the register method")," for the details)."),Object(r.b)("li",{parentName:"ol"},"You would then log in to ActiveWorkflow, go to 'create a new agent' panel,\nselect the agent with the name and description provided as a response to\nthe 'register' method, and you would create an instance of this agent.\nYou or other users could create multiple instances of this agent, possibly\nwith different options (if your agent is configurable)."),Object(r.b)("li",{parentName:"ol"},"If you schedule your agent instance to be invoked periodically, then\nActiveWorkflow would make a request to ",Object(r.b)("inlineCode",{parentName:"li"},"http://0.0.0.0:5000")," at the\nscheduled time with the method 'check'."),Object(r.b)("li",{parentName:"ol"},"Every time your agent receives a message from another agent, ActiveWorkflow\nwould call it with the method 'receive' passing the message along.")),Object(r.b)("h2",{id:"source-code"},"Source Code"),Object(r.b)("p",null,"You can find the ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/automaticmode/activeworkflow-agent-python"}),"activeworkflow_agent source code on GitHub"),"."))}p.isMDXComponent=!0},89:function(e,t,n){"use strict";n.d(t,"a",(function(){return d})),n.d(t,"b",(function(){return u}));var a=n(0),o=n.n(a);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var c=o.a.createContext({}),p=function(e){var t=o.a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=p(e.components);return o.a.createElement(c.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return o.a.createElement(o.a.Fragment,{},t)}},m=o.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=p(n),m=a,u=d["".concat(s,".").concat(m)]||d[m]||b[m]||r;return n?o.a.createElement(u,i(i({ref:t},c),{},{components:n})):o.a.createElement(u,i({ref:t},c))}));function u(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,s=new Array(r);s[0]=m;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:a,s[1]=i;for(var c=2;c<r;c++)s[c]=n[c];return o.a.createElement.apply(null,s)}return o.a.createElement.apply(null,n)}m.displayName="MDXCreateElement"}}]);