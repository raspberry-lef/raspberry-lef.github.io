(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{82:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return s})),n.d(t,"metadata",(function(){return l})),n.d(t,"toc",(function(){return i})),n.d(t,"default",(function(){return p}));var a=n(3),r=n(7),o=(n(0),n(89)),s={id:"activeworkflow-agent-ruby",title:"ActiveWorkflow Agent Ruby",sidebar_label:"ActiveWorkflow Agent Ruby"},l={unversionedId:"activeworkflow-agent-ruby",id:"activeworkflow-agent-ruby",isDocsHomePage:!1,title:"ActiveWorkflow Agent Ruby",description:"Helps you to develop your own ActiveWorkflow agents in Ruby.",source:"@site/docs/activeworkflow-agent-ruby.md",slug:"/activeworkflow-agent-ruby",permalink:"/activeworkflow-agent-ruby",version:"current",sidebar_label:"ActiveWorkflow Agent Ruby",sidebar:"someSidebar",previous:{title:"ActiveWorkflow Agent Python",permalink:"/activeworkflow-agent-python"}},i=[{value:"Installation",id:"installation",children:[]},{value:"The ActiveWorkflow Agent API Protocol",id:"the-activeworkflow-agent-api-protocol",children:[]},{value:"Library Functionality",id:"library-functionality",children:[{value:"ParsedRequest",id:"parsedrequest",children:[]},{value:"RegisterResponse",id:"registerresponse",children:[]},{value:"CheckResponse",id:"checkresponse",children:[]},{value:"ReceiveResponse",id:"receiveresponse",children:[]}]},{value:"Example Agent",id:"example-agent",children:[]},{value:"Running an Agent Locally for Development",id:"running-an-agent-locally-for-development",children:[]},{value:"Source Code",id:"source-code",children:[]}],c={toc:i};function p(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(o.b)("wrapper",Object(a.a)({},c,n,{components:t,mdxType:"MDXLayout"}),Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},"Helps you to develop your own ActiveWorkflow agents in Ruby.")),Object(o.b)("p",null,"The ",Object(o.b)("inlineCode",{parentName:"p"},"active_workflow_agent")," library helps you to write your own ActiveWorkflow\nagents in Ruby using ActiveWorkflow's ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"remote-agent-api/"}),"remote agent API"),".\n","\u201c","Remote","\u201d"," in this context means that agents run in separate processes\nfrom ActiveWorkflow itself. Communication between agents and ActiveWorkflow\ntakes place via HTTP. Each agent is effectively an HTTP server which ActiveWorkflow\nconnects to and interacts with via the ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"remote-agent-api/#protocol"}),"remote agent API protocol"),"."),Object(o.b)("h2",{id:"installation"},"Installation"),Object(o.b)("p",null,"Add this line to your agent's Gemfile:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ruby"}),"gem 'active_workflow_agent'\n")),Object(o.b)("p",null,"And then execute:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),"$ bundle install\n")),Object(o.b)("p",null,"Or install it yourself as:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),"$ gem install active_workflow_agent\n")),Object(o.b)("h2",{id:"the-activeworkflow-agent-api-protocol"},"The ActiveWorkflow Agent API Protocol"),Object(o.b)("p",null,"ActiveWorkflow talks to an agent over HTTP and all the requests and responses\nare in JSON. All communication happens using a single endpoint (the agent's\nregistered URL) and an agent has to implement and handle the following\n3 ","\u201c","methods","\u201d",":"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("strong",{parentName:"li"},"register"),": called to retrieve an agent's metadata (name, description, options)."),Object(o.b)("li",{parentName:"ul"},Object(o.b)("strong",{parentName:"li"},"receive"),": called when an agent has to process a message."),Object(o.b)("li",{parentName:"ul"},Object(o.b)("strong",{parentName:"li"},"check"),": called on schedule (as set by ActiveWorkflow users) and has no message to process.")),Object(o.b)("p",null,"For more details please see the ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"remote-agent-api#protocol"}),"remote agent API protocol"),"."),Object(o.b)("h2",{id:"library-functionality"},"Library Functionality"),Object(o.b)("p",null,"To deal with the protocol in your agent implementation this library offers four\nhelper classes that are described below."),Object(o.b)("h3",{id:"parsedrequest"},"ParsedRequest"),Object(o.b)("p",null,Object(o.b)("inlineCode",{parentName:"p"},"ParsedRequest")," is a helper class to parse the content of a ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"remote-agent-api#protocol"}),"request"),"\nfrom the ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"remote-agent-api"}),"ActiveWorkflow Agent API"),"."),Object(o.b)("h4",{id:"public-class-methods"},"Public Class Methods"),Object(o.b)("p",null,Object(o.b)("inlineCode",{parentName:"p"},"::new(request)")," - create a new ParsedRequest object."),Object(o.b)("h4",{id:"attributes"},"Attributes"),Object(o.b)("p",null,"A ParsedRequest object always has the following attributes:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("strong",{parentName:"li"},"method"),": a symbol representing the method called on the agent."),Object(o.b)("li",{parentName:"ul"},Object(o.b)("strong",{parentName:"li"},"options"),": a hash with all the agent options."),Object(o.b)("li",{parentName:"ul"},Object(o.b)("strong",{parentName:"li"},"memory"),": a hash with the state of the agent."),Object(o.b)("li",{parentName:"ul"},Object(o.b)("strong",{parentName:"li"},"credentials"),": an array of hashes containing credentials that the agent might need."),Object(o.b)("li",{parentName:"ul"},Object(o.b)("strong",{parentName:"li"},"message"),": a hash containing the message the agent received.")),Object(o.b)("h4",{id:"example"},"Example"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ruby"}),'require \'active_workflow_agent\'\n\nrequest = ActiveWorkflowAgent::ParsedRequest.new(request)\nrequest.method       # => :receive\nrequest.options      # => {"some": "option"}\nrequest.memory       # => {"could": {"be": "anything"}}\nrequest.credentials  # => [{"name": "admin_email", "value": "admin@example.com"}]\nrequest.message      # => {"a": 1, "b": 2}\n')),Object(o.b)("h3",{id:"registerresponse"},"RegisterResponse"),Object(o.b)("p",null,Object(o.b)("inlineCode",{parentName:"p"},"RegisterResponse")," is a helper class to construct a response to the ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"remote-agent-api#the-register-method"}),"'register' method")," API call. It has the following methods:"),Object(o.b)("h4",{id:"public-class-methods-1"},"Public Class Methods"),Object(o.b)("p",null,Object(o.b)("inlineCode",{parentName:"p"},"::new(name:, display_name:, description:, default_options:)")," - create a new RegisterResponse object. Arguments:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"name: a unique identifier string in upper CamelCase without any whitespace."),Object(o.b)("li",{parentName:"ul"},"display_name: a string containing the name of the agent for display purposes."),Object(o.b)("li",{parentName:"ul"},"description: a string containing the description of the agent in markdown format."),Object(o.b)("li",{parentName:"ul"},"default_options: (optional) a hash containing the agent's options.")),Object(o.b)("h4",{id:"public-instance-methods"},"Public Instance Methods"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"#to_h()"),": returns the response as a hash."),Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"#to_json()"),": returns the response as a JSON string.")),Object(o.b)("h4",{id:"example-1"},"Example"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ruby"}),'require \'active_workflow_agent\'\n\nresponse = ActiveWorkflowAgent::RegisterResponse.new(\n             name: "ExampleAgent",\n             display_name: "Example Agent",\n             description: "Just an example agent.",\n             default_options: {"a": "b"}\n           )\nresponse.to_json\n# => \'{"result": {"name": "ExampleAgent", "display_name": "Example Agent", "description": "Just an example agent.", "default_options": {"a": "b"}}}\'\n')),Object(o.b)("h3",{id:"checkresponse"},"CheckResponse"),Object(o.b)("p",null,Object(o.b)("inlineCode",{parentName:"p"},"CheckResponse")," is helper class to construct a response to the ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"remote-agent-api#the-check-method"}),"'check' method")," API call."),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"#add_logs(*str)"),": add one or more log messages to the response object."),Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"#add_errors(*str)"),": add one or more error messages to the response object."),Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"#add_messages(*hash)"),": add the messages that the agent will emit."),Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"#add_memory(hash)"),": add the agent's memory (state) to the response object."),Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"#to_h()"),": returns the response as a hash."),Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"#to_json()"),": returns the response as a JSON string.")),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ruby"}),'require \'active_workflow_agent\'\n\nresponse = ActiveWorkflowAgent::CheckResponse.new\nresponse.add_logs("Check done")\nresponse.add_errors("An error occurred")\nresponse.to_h\n# => \'{"result": {"errors": ["An error occurred"], "logs": ["Check done"], "memory": {}, "messages": []}}\'\n')),Object(o.b)("h3",{id:"receiveresponse"},"ReceiveResponse"),Object(o.b)("p",null,Object(o.b)("inlineCode",{parentName:"p"},"ReceiveResponse")," is a helper class to construct a response to the ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"remote-agent-api#the-receive-method"}),"'receive' method")," API call."),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"#add_logs(*str)"),": add one or more log messages to the response object."),Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"#add_errors(*str)"),": add one or more error messages to the response object."),Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"#add_messages(*hash)"),": add the messages that the agent will emit."),Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"#add_memory(hash)"),": add the agent's memory (state) to the response object."),Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"#to_h()"),": returns the response as a hash."),Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"#to_json()"),": returns the response as a JSON string.")),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ruby"}),'require \'active_workflow_agent\'\n\nresponse = ActiveWorkflowAgent::ReceiveResponse.new\nresponse.add_logs("New message received", "Message processed")\nresponse.to_json\n# => \'{"result": {"errors": [], "logs": ["New message received", "Message processed"], "memory": {}, "messages": []}}\'\n')),Object(o.b)("h2",{id:"example-agent"},"Example Agent"),Object(o.b)("p",null,"Below you can find an example of an ActiveWorkflow agent using the library helper classes."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-ruby"}),'require "sinatra"\nrequire "active_workflow_agent"\n\npost "/" do\n  req = JSON.parse request.body.read\n  parsed_request = ActiveWorkflowAgent::ParsedRequest.new(req)\n\n  case parsed_request.method\n  when :register\n    respond_to_register\n  when :check\n    respond_to_check\n  when :receive\n    respond_to_receive(parsed_request)\n  else\n    {}\n  end\nend\n\ndef respond_to_register\n  ActiveWorkflowAgent::RegisterResponse.new(\n    name: "ExampleAgent",\n    display_name: "Example Agent",\n    description: "This is a simple agent that does nothing."\n  ).to_json\nend\n\ndef respond_to_check\n  response = ActiveWorkflowAgent::CheckResponse.new\n  response.add_logs("A log message")\n  response.add_messages(\n    { "Message" => "in a bottle" },\n    { "Something" => "else" }\n  )\n  response.to_json\nend\n\ndef respond_to_receive(parsed_request)\n  response = ActiveWorkflowAgent::CheckResponse.new\n  response.add_errors("Log an error", "Another error")\n  # Devise some memory hash.\n  memory = {\n    "previous_memory" => parsed_request.memory,\n    "message_received" => parsed_request.message\n  }\n  response.add_memory(memory)\n  response.add_messages({ "message_received" => parsed_request.message })\n  response.to_json\nend\n')),Object(o.b)("h2",{id:"running-an-agent-locally-for-development"},"Running an Agent Locally for Development"),Object(o.b)("p",null,"Suppose that for development purposes you have created a simple agent that can run locally on ",Object(o.b)("inlineCode",{parentName:"p"},"http://0.0.0.0:4567")," and you also run ActiveWorkflow using Docker. You would typically proceed in the following manner:"),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},"You would first start your agent process at ",Object(o.b)("inlineCode",{parentName:"li"},"http://0.0.0.0:4567"),"."),Object(o.b)("li",{parentName:"ol"},"You would then start ActiveWorkflow locally with Docker, registering your agent by passing an environment variable. For example: ",Object(o.b)("inlineCode",{parentName:"li"},'docker run -e REMOTE_AGENT_URL="http://host.docker.internal:4567/" -p 3000:3000 --rm automaticmode/active_workflow'),"."),Object(o.b)("li",{parentName:"ol"},"When starting, ActiveWorkflow would make a request to your agent at ",Object(o.b)("inlineCode",{parentName:"li"},"http://0.0.0.0:4567")," with the 'register' method, in order to retrieve your agent's information. (see ",Object(o.b)("a",Object(a.a)({parentName:"li"},{href:"remote-agent-api/#the-register-method"}),"the register method")," for the details)."),Object(o.b)("li",{parentName:"ol"},"You would then log in to ActiveWorkflow, go to 'create a new agent' panel, select the agent with the name and description provided as a response to the '",Object(o.b)("strong",{parentName:"li"},"register"),"' method, and you would create an instance of this agent. You or other users could create multiple instances of this agent, possibly with different options (if your agent is configurable)."),Object(o.b)("li",{parentName:"ol"},"If you schedule your agent instance to be invoked periodically, then ActiveWorkflow would make a request to ",Object(o.b)("inlineCode",{parentName:"li"},"http://0.0.0.0:4567")," at the scheduled time with the method '",Object(o.b)("strong",{parentName:"li"},"check"),"'."),Object(o.b)("li",{parentName:"ol"},"Every time your agent receives a message from another agent, ActiveWorkflow would call it with the method '",Object(o.b)("strong",{parentName:"li"},"receive"),"' passing the message along.")),Object(o.b)("h2",{id:"source-code"},"Source Code"),Object(o.b)("p",null,"You can find the ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/automaticmode/active_workflow_agent"}),"activeworkflow_agent source code on GitHub"),"."))}p.isMDXComponent=!0},89:function(e,t,n){"use strict";n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return m}));var a=n(0),r=n.n(a);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=r.a.createContext({}),p=function(e){var t=r.a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},b=function(e){var t=p(e.components);return r.a.createElement(c.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},d=r.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),b=p(n),d=a,m=b["".concat(s,".").concat(d)]||b[d]||u[d]||o;return n?r.a.createElement(m,l(l({ref:t},c),{},{components:n})):r.a.createElement(m,l({ref:t},c))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,s=new Array(o);s[0]=d;var l={};for(var i in t)hasOwnProperty.call(t,i)&&(l[i]=t[i]);l.originalType=e,l.mdxType="string"==typeof e?e:a,s[1]=l;for(var c=2;c<o;c++)s[c]=n[c];return r.a.createElement.apply(null,s)}return r.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"}}]);